---
title: "Getting started with timeternR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with timeternR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
devtools::load_all()
```

<left>
![](timeternRhex.png){width=100px}
</left>

# Installation

To install `timeternR`, run the folllowing code.

```{r eval = FALSE}
if(!require(timeternR)){
  library(devtools)
  devtools::install_github("shannong19/timeternR")
}
library(timeternR)
```

```{r echo = F, message = F, warning = F}
# hidden load currently
library(devtools)
devtools::load_all()
```

# Quickstart

```{r setup, message = FALSE, warning = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggtern)
```

The below takes a data frame of individuals who have reported infection and recovery times, groups them into male and females, aggregates the groups to find the number of susceptible, infectious, and recovered, and plots them in the ternary view.

```{r quickstart, fig.width=6, eval=TRUE}

## Visualizing epidemic progression using timeternR
library(kableExtra)
timeternR::hagelloch_raw %>% head() %>%
  select(PN, NAME, AGE, SEX,
         tPRO, tERU, tI, tR) %>%
  knitr::kable() %>%
  kableExtra::kable_styling()

timeternR::hagelloch_raw %>%
   dplyr::filter(SEX %in% c("male", "female")) %>%
   ggplot(aes(y = tI, z = tR, color = SEX)) +
     timeternR::stat_sir(data_type = "raw") + 
     coord_tern() +
     labs(x = "S", y = "I", z = "R",
          color = "Gender")

```


The below code simulates SIR data at the individual (or agent) level, aggregates it into SIR format, and plots it in the ``standard'' view of *percent in state* vs. *time*.

	
```{r, eval = TRUE}


## Simulating epidemics with `simulate_SIR_agents`.

n_sims <- 1
n_time_steps <- 100
beta <- .1
gamma <- .03
init_SIR <- c(950, 50, 0)
output_format <- "data.frame"
    
out <- timeternR::simulate_SIR_agents(n_sims = n_sims,
                                 n_time_steps = n_time_steps,
                                 beta = beta, gamma = gamma,
                                 init_SIR = init_SIR,
                                 output_format = output_format)
                                 
df_ave <- out %>% UtoX_SIR %>%
  group_by(t) %>% summarize(S = mean(S), I = mean(I), R = mean(R))

ggplot(data = (df_ave %>% gather(key = "State", value = "Value",
                                S, I, R)),
       aes(x = t, y = Value, group = State,
col = State)) +
  geom_line()

<<<<<<< HEAD
ggtern(data = df_ave, aes(x = S, y = I, z = R)) + geom_path()
=======
ggplot(data = (df_ave %>% gather(key = "State", value = "Value",
                                S, I, R)),
       aes(x = t, y = Value)) +
  facet_grid(State~.) + 
  geom_line()



```


