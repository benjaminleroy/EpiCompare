---
title: "Getting started with timeternR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with timeternR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center"
)
```

<left>
![](timeternRhex.png){width=100px}
</left>

# Installation

To install `timeternR`, run the folllowing code.

```{r eval = FALSE}
if(!require(timeternR)){
  library(devtools)
  devtools::install_github("shannong19/timeternR")
}
library(timeternR)
```

```{r echo = F, message = F, warning = F}
# hidden load currently
library(devtools)
devtools::load_all()
```

# Quickstart

```{r setup, message = FALSE, warning = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggtern)
```


## Visualizing epidemic progression using timeternR

```{r eval = T, warning = F, message = F}
library(kableExtra)
timeternR::hagelloch_raw %>% head() %>%
  select(PN, NAME, AGE, SEX,
         tPRO, tERU, tI, tR) %>%
  knitr::kable() %>%
  kableExtra::kable_styling()
```

```{r}
theme_set(theme_minimal())
```


```{r quickstart, fig.width=6, eval=T}
timeternR::hagelloch_raw %>%
   filter(SEX %in% c("male", "female")) %>%
   ggplot(aes(y = tI, z = tR, color = SEX)) +
   geom_sir(data_type = "raw") + 
   geom_point(stat = "SirRaw") + 
     coord_tern() +
     labs(x = "S", y = "I", z = "R",
          color = "Gender") 

```

## Simulating epidemics with `simulate_SIR_agents`.

```{r, eval = T, fig.asp = .62, out.width = '60%'}
n_sims <- 1
n_time_steps <- 100
beta <- .1
gamma <- .03
init_SIR <- c(950, 50, 0)
output_format <- "data.frame"
    
out <- timeternR::simulate_SIR_agents(n_sims = n_sims,
                                 n_time_steps = n_time_steps,
                                 beta = beta, gamma = gamma,
                                 init_SIR = init_SIR,
                                 output_format = output_format)
                                 
df_ave <- out %>% UtoX_SIR %>%
  group_by(t) %>% summarize(S = mean(S), I = mean(I), R = mean(R))

if (tidyr_new_interface()){ # if tidyr version > 0.8.99
  df_ave_lines <- df_ave %>% pivot_longer(names_to = "State", 
                                          values_to = "Value",
                                          cols = c(S, I, R))
} else {
  df_ave_lines <- df_ave %>% gather(key = "State", value = "Value",
                                S, I, R)
}

  
ggplot(data = df_ave_lines,
       aes(x = t, y = Value, group = State, color = State)) +
  geom_line() 

ggplot(data = df_ave_lines,
       aes(x = t, y = Value)) +
  facet_grid(State~.) + 
  geom_line() 

```


