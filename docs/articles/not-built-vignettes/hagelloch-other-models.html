<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hagelloch Measles -- Fitting a Stochastic SIR Model • EpiCompare</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Hagelloch Measles -- Fitting a Stochastic SIR Model">
<meta property="og:description" content="EpiCompare">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">EpiCompare</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/ternary-plots-explained.html">An Introduction to Ternary Plots</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/comparing-bands-and-assessing-containment.html">Comparing Models (to Models) and Epidemics (to Models)</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/depths-impact-on-prediction-bands.html">Understanding Prediction Bands and Impact of Quantile/Ordering Functions</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/example-epimodel.html">Using EpiModel models with EpiCompare</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/basic-abm.html">Basic simulations with EpiCompare</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/EpiCompare/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hagelloch-other-models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hagelloch Measles – Fitting a Stochastic SIR Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/EpiCompare/blob/master/vignettes/not-built-vignettes/hagelloch-other-models.Rmd"><code>vignettes/not-built-vignettes/hagelloch-other-models.Rmd</code></a></small>
      <div class="hidden name"><code>hagelloch-other-models.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this series of vignettes, we will demonstrate epidemic analysis pipeline from EDA to dissemination using a case study of measles.</p>
</div>
<div id="the-epidemic-analysis-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#the-epidemic-analysis-pipeline" class="anchor"></a>The Epidemic Analysis Pipeline</h2>
<p><img src="images/pipeline1.png"></p>
</div>
<div id="hagelloch-series-vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#hagelloch-series-vignettes" class="anchor"></a>Hagelloch series vignettes</h2>
<p><a href="hagelloch-eda.html">Hagelloch 1 Pre-processing and EDA</a></p>
<p><a href="hagelloch-mods.html">Hagelloch 2.1 Modeling and Simulation: the SIR model</a></p>
<p><a href="hagelloch-sir-fit.html">Hagelloch 2.2 Modeling and Simulation: fitting a SIR model</a></p>
<p><a href="hagelloch-sir-stochastic.html">Hagelloch 2.3.1 Modeling and Simulation: a stochastic SIR model</a></p>
<p><a href="hagelloch-sir-stochastic-three-groups.html">Hagelloch 2.3.2 Modeling and Simulation: a stochastic SIR model</a></p>
<p><strong><a href="hagelloch-other-mods.html">Hagelloch 2.4 Modeling and Simulation with other packages</a></strong></p>
</div>
<div id="goals-in-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#goals-in-this-vignette" class="anchor"></a>Goals in this vignette</h2>
<ol style="list-style-type: decimal">
<li><p>Recap our work with the Hagelloch vignette thus far</p></li>
<li><p>Explain <code>EpiCompare</code>’s role in incorporating other models such as from <code>EpiModel</code>.</p></li>
<li><p>Include side-by-side comparison of different models</p></li>
</ol>
</div>
<div id="the-story-so-far" class="section level2">
<h2 class="hasAnchor">
<a href="#the-story-so-far" class="anchor"></a>The story so far</h2>
<p>In this series of vignettes, we have looked at the Hagelloch measles outbreak and suspect that the classes have different rates of infection. In particular, we suspect a ‘super-spreader’ event in the first class to be driving the fit of our models. This event makes it so that within that class the infection rate is very large and relatively small in the other compartments. Our model fits do not accurately capture the two peaks of infection seen in our data.</p>
<p>We now use the <code>EpiModel</code> package to simulate a network-based outbreak on the Hagelloch children.</p>
</div>
<div id="epicompare-works-with-your-modeling-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#epicompare-works-with-your-modeling-packages" class="anchor"></a><code>EpiCompare</code> works with your modeling packages</h2>
<p>We at <code>EpiCompare</code> understand the importance and necessity of model variety and also the value of reproducibility in code. We aim to facilitate this important process by allowing users to more easily interact and assess different modeling paradigms.</p>
<p>We look at a couple here..</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EpiModel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EpiCompare</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## WARNING:  Will take a minute or two</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>)
<span class="no">nw</span> <span class="kw">&lt;-</span> <span class="fu">network.initialize</span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">188</span>, <span class="kw">directed</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">nw</span> <span class="kw">&lt;-</span> <span class="fu">set.vertex.attribute</span>(<span class="no">nw</span>, <span class="st">"group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>:<span class="fl">2</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fl">90</span>, <span class="fl">30</span>, <span class="fl">68</span>))
<span class="no">formation</span> <span class="kw">&lt;-</span> ~<span class="no">edges</span> + <span class="fu">nodematch</span>(<span class="st">"group"</span>) + <span class="no">concurrent</span>
<span class="no">target.stats</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">200</span>)
<span class="no">coef.diss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/dissolution_coefs.html">dissolution_coefs</a></span>(<span class="kw">dissolution</span> <span class="kw">=</span> ~<span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span>(<span class="no">edges</span>),  <span class="kw">duration</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">est1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/netest.html">netest</a></span>(<span class="no">nw</span>, <span class="no">formation</span>, <span class="no">target.stats</span>, <span class="no">coef.diss</span>, <span class="kw">edapprox</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">param</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/param.net.html">param.net</a></span>(<span class="kw">inf.prob</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">act.rate</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">rec.rate</span> <span class="kw">=</span> <span class="fl">0.1</span>)
<span class="no">status.vector</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fl">90</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fl">30</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fl">67</span>), <span class="fl">1</span>)
<span class="no">status.vector</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">status.vector</span> <span class="kw">==</span> <span class="fl">1</span>, <span class="st">"i"</span>, <span class="st">"s"</span>)
<span class="no">init</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/init.net.html">init.net</a></span>(<span class="kw">status.vector</span> <span class="kw">=</span> <span class="no">status.vector</span>)
<span class="no">control</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/control.net.html">control.net</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"SIR"</span>, <span class="kw">nsteps</span> <span class="kw">=</span> <span class="fl">55</span>,
                       <span class="kw">nsims</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">epi.by</span> <span class="kw">=</span> <span class="st">"group"</span>)
<span class="no">sim_output</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiModel/man/netsim.html">netsim</a></span>(<span class="no">est1</span>, <span class="no">param</span>, <span class="no">init</span>, <span class="no">control</span>)</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fortified_net</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiCompare/man/fortify_aggregate.html">fortify_aggregate</a></span>(<span class="no">sim_output</span>, <span class="kw">states</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s.num"</span>, <span class="st">"i.num"</span>, <span class="st">"r.num"</span>))</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">obs_groups</span> <span class="kw">&lt;-</span> <span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">class</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">CL</span> <span class="kw">==</span> <span class="st">"1st class"</span>,
                        <span class="fl">1</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">CL</span> <span class="kw">==</span> <span class="st">"2nd class"</span>,
                               <span class="fl">2</span>, <span class="fl">0</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/EpiCompare/man/agents_to_aggregate.html">agents_to_aggregate</a></span>(<span class="kw">states</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">tI</span>, <span class="no">tR</span>),
                      <span class="kw">min_max_time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">55</span>)) <span class="kw">%&gt;%</span>
   <span class="fu">rename</span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">S</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">I</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">R</span> <span class="kw">=</span> <span class="no">X2</span>)

  <span class="fu">ggplot</span>() +
    <span class="fu"><a href="https://rdrr.io/pkg/EpiCompare/man/geom_prediction_band.html">geom_prediction_band</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">fortified_net</span>,
                         <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">X2</span>, <span class="kw">t</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">sim_group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">sim</span>)),
                         <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.2</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"blue"</span>,
                         <span class="kw">conf_level</span> <span class="kw">=</span> <span class="fl">.9</span>, <span class="kw">pb_type</span> <span class="kw">=</span> <span class="st">"delta_ball"</span>) +
    <span class="fu">theme_bw</span>() +
    <span class="fu">coord_tern</span>() +
    <span class="fu">geom_path</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">fortified_net</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">X2</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">sim</span>)),
              <span class="kw">col</span> <span class="kw">=</span> <span class="st">"cornflowerblue"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">.3</span>) +
    <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">obs_groups</span>,
               <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">S</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">R</span> ),
               <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>)</pre></body></html></div>
<p><img src="hagelloch-other-models_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Here we see that the above simulation covers the data quite well. However, upon closer inspection we see that the single paths (i.e. filaments) of an epidemic are generally not the shape of the observed data which has two distinct peaks.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">sim_output</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"network"</span>, <span class="kw">col.status</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">sims</span> <span class="kw">=</span> <span class="fl">5</span>)</pre></body></html></div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://skgallagher.github.io/">Shannon Gallagher</a>, <a href="https://benjaminleroy.github.io/">Benjamin LeRoy</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
