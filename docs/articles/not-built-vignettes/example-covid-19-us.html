<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COVID-19 and EpiCompare • EpiCompare</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="COVID-19 and EpiCompare">
<meta property="og:description" content="EpiCompare">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">EpiCompare</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/ternary-plots-explained.html">An Introduction to Ternary Plots</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/comparing-bands-and-assessing-containment.html">Comparing Models (to Models) and Epidemics (to Models)</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/depths-impact-on-prediction-bands.html">Understanding Prediction Bands and Impact of Quantile/Ordering Functions</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/example-epimodel.html">Using EpiModel models with EpiCompare</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/basic-abm.html">Basic simulations with EpiCompare</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/EpiCompare/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example-covid-19-us_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="example-covid-19-us_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>COVID-19 and EpiCompare</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/EpiCompare/blob/master/vignettes/not-built-vignettes/example-covid-19-us.Rmd"><code>vignettes/not-built-vignettes/example-covid-19-us.Rmd</code></a></small>
      <div class="hidden name"><code>example-covid-19-us.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Data for the COVID-19 outbreak is available publicly from many sources including from the <a href="https://github.com/CSSEGISandData/COVID-19">Johns Hopkins Coronavirus Tracker</a> github repository (<span class="citation">(Dong, Du, and Gardner 2020)</span>). We want to use EpiCompare to compare outbreaks in different US states.</p>
<p>In this vignette, we assume a <strong>SIR</strong> disease progression. That is, individuals begin in the susceptible state, move to the infectious state, and then finally are recovered.</p>
<p>In this vignette, we will</p>
<ol style="list-style-type: decimal">
<li><p>Download JHU Coronavirus data via the <code>R COVID19</code> package (<span class="citation">(Guidotti, n.d.)</span>).</p></li>
<li><p>Convert to SI format.</p></li>
<li><p>Impute a <strong>random</strong> number of recovered based on infection duration estimates to make the data into SIR format.</p></li>
<li><p>Compare the states’ outbreaks using EpiCompare.</p></li>
</ol>
<p>You will need to install/load the following packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EpiCompare</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">COVID19</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RColorBrewer</span>)
<span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</pre></body></html></div>
</div>
<div id="downloading-the-coronavirus-data-for-the-us" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-the-coronavirus-data-for-the-us" class="anchor"></a>Downloading the coronavirus data for the US</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://covid19datahub.io/reference/covid19.html">covid19</a></span>(<span class="st">"USA"</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>  <span class="co">## State level US data, will take a few seconds</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>( <span class="kw">state</span> <span class="kw">=</span> <span class="no">administrative_area_level_2</span>)</pre></body></html></div>
<p>Hale Thomas, Sam Webster, Anna Petherick, Toby Phillips, and Beatriz Kira (2020). Oxford COVID-19 Government Response Tracker, Blavatnik School of Government.</p>
<p>The COVID Tracking Project (2020), <a href="https://covidtracking.com" class="uri">https://covidtracking.com</a></p>
<p>Johns Hopkins Center for Systems Science and Engineering (2020), <a href="https://github.com" class="uri">https://github.com</a></p>
<p>Guidotti, E., Ardia, D., (2020), “COVID-19 Data Hub”, Working paper, doi: 10.13140/RG.2.2.11649.81763.</p>
<p>To see these entries in BibTeX format, use ‘print(<citation>, bibtex=TRUE)’, ‘toBibtex(.)’, or set ‘options(citation.bibtex.max=999)’.</citation></p>
<p>To hide the data sources use ‘verbose = FALSE’.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">state</span>, <span class="no">date</span>, <span class="no">confirmed</span>, <span class="no">recovered</span>, <span class="no">deaths</span>, <span class="no">population</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="kw">position</span> <span class="kw">=</span> <span class="st">"center"</span>)</pre></body></html></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:left;">
state
</th>
<th style="text-align:left;">
date
</th>
<th style="text-align:right;">
confirmed
</th>
<th style="text-align:right;">
recovered
</th>
<th style="text-align:right;">
deaths
</th>
<th style="text-align:right;">
population
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-12
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
<tr>
<td style="text-align:left;">
121cd66e
</td>
<td style="text-align:left;">
Minnesota
</td>
<td style="text-align:left;">
2020-01-17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5639632
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>)

<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">y</span> <span class="kw">=</span><span class="no">confirmed</span> / <span class="no">population</span>,
                        <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2020-03-16"</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data</span>$<span class="no">date</span>) + <span class="fl">5</span>)) +
  <span class="fu">geom_text</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">.</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">date</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">date</span>)),
            <span class="fu">aes</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="no">state</span>), <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">.001</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>)  +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"(Cumulative Confirmed Cases) / (Population Size)"</span>)  +  <span class="fu">scale_colour_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">5</span>,<span class="st">"Set1"</span>),
                                <span class="kw">times</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">HN</span>)) / <span class="fl">5</span>)),
                      <span class="kw">guide</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>From this, it looks like the state dominates the others in terms of cumulative cases, even after adjusting for population size.</p>
<p>However, the outbreak did not begin on the same day in the states. So perhaps, we want to adjust for the timing. We can adjust the dates relative to the first case reported in the state.</p>
<p>This looks like the following:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>( <span class="kw">state</span> <span class="kw">=</span> <span class="no">administrative_area_level_2</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">confirmed</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">first_date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">date</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rel_date</span> <span class="kw">=</span> <span class="no">date</span> - <span class="no">first_date</span> )

<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">confirmed</span> / <span class="no">population</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>,
                        <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data</span>$<span class="no">rel_date</span>) + <span class="fl">10</span>)) +
  <span class="fu">geom_text</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">.</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">date</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">date</span>)),
            <span class="fu">aes</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="no">state</span>), <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">.001</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>)  +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Days relative to first case in state"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"(Cumulative Confirmed Cases) / (Population Size)"</span>) +
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">5</span>,<span class="st">"Set1"</span>),
                                <span class="kw">times</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">HN</span>)) / <span class="fl">5</span>)),
                      <span class="kw">guide</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This view looks a little different from the raw-time version and now New York does not look to be completely dominant. On the other hand, this view makes it hard to compare states like MA, Illinois, CA, and AZ – states which all had an early case but did not have a sustained outbreak until much later.</p>
<p>Another idea is to standardize the time relative to the first time the .0005 cumulative cases per population threshold is crossed.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">data2</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">confirmed</span>/<span class="no">population</span> <span class="kw">&gt;</span> <span class="fl">0.0005</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">first_date</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">date</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rel_date</span> <span class="kw">=</span> <span class="no">date</span> - <span class="no">first_date</span>)

<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data2</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">confirmed</span> / <span class="no">population</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>,
                         <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data2</span>$<span class="no">rel_date</span>) + <span class="fl">5</span>)) +
  <span class="fu">geom_text</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">.</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">date</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">date</span>)),
            <span class="fu">aes</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="no">state</span>), <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">.001</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>)  +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Days relative to .0005 Cases/Pop threshold"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"(Cumulative Confirmed Cases) / (Population Size)"</span>) +
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">5</span>,<span class="st">"Set1"</span>),
                                <span class="kw">times</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">HN</span>)) / <span class="fl">5</span>)),
                      <span class="kw">guide</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Now it looks like New Jersey, in fact, looks like it has a worse outbreak than New York?</p>
<p><strong>Which picture shows the truth?</strong></p>
<p>We can play the same game over and over, we can pick arbitrary time points or thresholds to plot the relative time of the outbreak. As we see, this time point can skew our view of the outbreak.</p>
<p>An alternative to this arbitrary scaling is to use Time Free Analysis (TFA).</p>
</div>
<div id="adding-in-the-recovered" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-in-the-recovered" class="anchor"></a>Adding in the Recovered</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">gamma</span> <span class="kw">&lt;-</span> <span class="fl">1</span>/<span class="fl">14</span> <span class="co"># assuming 14 days recovery</span>
<span class="no">data3</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">new_cases</span> <span class="kw">=</span> <span class="no">confirmed</span> - <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span>(<span class="no">confirmed</span>),
         <span class="kw">lag1_cases</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span>(<span class="no">confirmed</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">new_cases</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">new_cases</span>) <span class="kw">|</span> <span class="no">new_cases</span> <span class="kw">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="no">new_cases</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">new_recov</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">lag1_cases</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">gamma</span>))

<span class="no">states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"New York"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Louisiana"</span>,
                                          <span class="st">"Massachusetts"</span>, <span class="st">"Connecticut"</span>,
                                          <span class="st">"District of Columbia"</span>, <span class="st">"Rhode Island"</span>,
                                          <span class="st">"Michigan"</span>, <span class="st">"Pennsylvania"</span>)

<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">%in%</span> <span class="no">states</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">confirmed</span> / <span class="no">population</span>,
                        <span class="kw">y</span><span class="kw">=</span> <span class="no">state</span>,
                        <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">date</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.4</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">deaths</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">date</span>,
        <span class="kw">S</span> <span class="kw">=</span> (<span class="no">population</span> - <span class="no">confirmed</span>) / <span class="no">population</span> * <span class="fl">100</span>,
         <span class="kw">I</span> <span class="kw">=</span> (<span class="no">confirmed</span> - <span class="no">deaths</span>) / <span class="no">population</span> * <span class="fl">100</span>,
        <span class="kw">Deaths</span> <span class="kw">=</span> <span class="no">deaths</span> / <span class="no">population</span> * <span class="fl">100</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">state</span>, <span class="no">time</span>, <span class="no">S</span>, <span class="no">I</span>, <span class="no">Deaths</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()

<span class="no">sub</span> <span class="kw">&lt;-</span> <span class="no">deaths</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">==</span> <span class="st">"Pennsylvania"</span>)


<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">deaths</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">%in%</span> <span class="no">states</span>),
       <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">S</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">Deaths</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.7</span>) + <span class="fu">coord_tern</span>() + <span class="fu">theme_zoom_L</span>(<span class="fl">.02</span>)  +
  <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Ternary"</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">data_grouped</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">state</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">N</span> <span class="kw">=</span> <span class="no">population</span>)

<span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/cases_to_SIR.html">cases_to_SIR</a></span>(<span class="no">data_grouped</span>, <span class="kw">par</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gamma"</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">14</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">S</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">I</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">R</span> <span class="kw">=</span> <span class="no">X2</span>)



<span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">out</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">%in%</span> <span class="no">states</span>),
       <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">S</span> / <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>/ <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">R</span>/ <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) + <span class="fu">coord_tern</span>() + <span class="fu">geom_path</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.8</span>) +  <span class="fu">theme_zoom_L</span>(<span class="fl">.02</span>) +
  <span class="fu">scale_color_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Paired"</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">out</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">%in%</span> <span class="no">states</span>),
       <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">S</span> / <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>/ <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">R</span>/ <span class="no">N</span> * <span class="fl">100</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">state</span>)) + <span class="fu">coord_tern</span>() + <span class="fu">geom_path</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.8</span>) +  <span class="fu">theme_zoom_L</span>(<span class="fl">.02</span>) +
  <span class="fu">scale_color_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Paired"</span>) + <span class="fu">facet_wrap</span>(~<span class="no">state</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="example-covid-19-us_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-dong2020">
<p>Dong, Ensheng, Hongru Du, and Lauren Gardner. 2020. “An Interactive Web-Based Dashboard to Track Covid-19 in Real Time.” <em>The Lancet Infectious Diseases</em>.</p>
</div>
<div id="ref-covid19-kaggle-r">
<p>Guidotti, Emanuele. n.d. “Coronavirus Covid-19 (2019-nCoV) Epidemic Datasets.” Kaggle. <a href="https://doi.org/10.34740/KAGGLE/DS/574488">https://doi.org/10.34740/KAGGLE/DS/574488</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://skgallagher.github.io/">Shannon Gallagher</a>, <a href="https://benjaminleroy.github.io/">Benjamin LeRoy</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
