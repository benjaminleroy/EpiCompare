<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hagelloch Measles -- Pre-processing and EDA • EpiCompare</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Hagelloch Measles -- Pre-processing and EDA">
<meta property="og:description" content="EpiCompare">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">EpiCompare</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/ternary-plots-explained.html">An Introduction to Ternary Plots</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/comparing-bands-and-assessing-containment.html">Comparing Models (to Models) and Epidemics (to Models)</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/depths-impact-on-prediction-bands.html">Understanding Prediction Bands and Impact of Quantile/Ordering Functions</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/example-epimodel.html">Using EpiModel models with EpiCompare</a>
    </li>
    <li>
      <a href="../../articles/not-built-vignettes/basic-abm.html">Basic simulations with EpiCompare</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skgallagher/EpiCompare/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hagelloch-eda_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="hagelloch-eda_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hagelloch Measles – Pre-processing and EDA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skgallagher/EpiCompare/blob/master/vignettes/not-built-vignettes/hagelloch-eda.Rmd"><code>vignettes/not-built-vignettes/hagelloch-eda.Rmd</code></a></small>
      <div class="hidden name"><code>hagelloch-eda.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this series of vignettes, we will demonstrate epidemic analysis pipeline from EDA to dissemination using a case study of measles.</p>
</div>
<div id="the-epidemic-analysis-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#the-epidemic-analysis-pipeline" class="anchor"></a>The Epidemic Analysis Pipeline</h2>
<p><img src="images/pipeline1.png"></p>
</div>
<div id="hagelloch-series-vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#hagelloch-series-vignettes" class="anchor"></a>Hagelloch series vignettes</h2>
<p><strong><a href="hagelloch-eda.html">Hagelloch 1 Pre-processing and EDA</a></strong></p>
<p><a href="hagelloch-mods.html">Hagelloch 2.1 Modeling and Simulation: the SIR model</a></p>
<p><a href="hagelloch-sir-fit.html">Hagelloch 2.2 Modeling and Simulation: fitting a SIR model</a></p>
<p><a href="hagelloch-sir-stochastic.html">Hagelloch 2.3.1 Modeling and Simulation: a stochastic SIR model</a></p>
<p><a href="hagelloch-sir-stochastic-three-groups.html">Hagelloch 2.3.2 Modeling and Simulation: a stochastic SIR model</a></p>
<p><a href="hagelloch-other-mods.html">Hagelloch 2.4 Modeling and Simulation with other packages</a></p>
</div>
<div id="goals-in-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#goals-in-this-vignette" class="anchor"></a>Goals in this vignette</h2>
<ol style="list-style-type: decimal">
<li><p>Describe the Hagelloch measles data</p></li>
<li><p>Illustrate some of the interesting features</p></li>
<li><p>Show how <code>EpiCompare</code> can be used to aid with EDA</p></li>
</ol>
</div>
<div id="intro-measles-outbreak-in-hagelloch-germany-1861-1862" class="section level2">
<h2 class="hasAnchor">
<a href="#intro-measles-outbreak-in-hagelloch-germany-1861-1862" class="anchor"></a>Intro: Measles outbreak in Hagelloch, Germany 1861-1862</h2>
<p>(Note that part of this section is taken with permission from <span class="citation">Gallagher (2019)</span>.)</p>
<p>The Hagelloch data was initially collected by <span class="citation">Pfeilsticker (1863)</span> and further analyzed by <span class="citation">Oesterle (1992)</span>. The data set follows the course of a measles epidemic in Hagelloch, Germany from October 30, 1861 (Day 0) until January 24, 1862, covering a period of 87 days.</p>
<p>This data set is available, not only in our package, but also from the <code>surveillance</code> package <span class="citation">(Meyer, Held, and Höhle 2017)</span>.</p>
<p>Previous analyses using the this data set include <span class="citation">Neal and Roberts (2004)</span>; <span class="citation">Britton, Kypraios, and O’Neill (2011)</span>; <span class="citation">Groendyke, Welch, and Hunter (2012)</span>; and <span class="citation">Cori et al. (2013)</span>. We encourage reading these insightful analyses.</p>
<div id="general-measles-information" class="section level3">
<h3 class="hasAnchor">
<a href="#general-measles-information" class="anchor"></a>General measles information</h3>
<p>Along with mumps, rubella, and varicella, measles is a highly infectious childhood disease. Symptoms of of the disease include high fever, cough, runny nose, and red, watery eyes. Two to three days after initial symptoms, tiny white spots may be found in the mouth. Three to five days after the symptoms begin, a rash appears on the body. A high fever (104 degrees F or more) may also be observed. Finally, the rash and fever resolve after a few days <span class="citation">(Centers for Disease Control and Prevention 2018)</span>.</p>
<p>Measles is transferred from person to person through contaminated air or an infected surface. <span class="citation">(Centers for Disease Control and Prevention 2018)</span> reports that a person is infectious four days before and after the appearance of the rash. Measles is perhaps the most contagious person-disease on the planet, with a reproductive number estimated of around <span class="math inline">\(R_0 = 19\)</span> <span class="citation">(Anderson and May 1992)</span>, which means that when an infectious person is introduced to a fully susceptible population, she will infect on average 19 others. In fact, a seven year-old boy in the Hagelloch data set purportedly infected 30 other individuals. However, more recent estimates of <span class="math inline">\(R_0\)</span> for measles are closer to 6-7 <span class="citation">(Getz et al. 2016)</span>.</p>
</div>
</div>
<div id="exploring-the-measles-dataset-in-r-" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-measles-dataset-in-r-" class="anchor"></a>Exploring the measles dataset in <code>R</code>.</h2>
<p>After loading the libraries,</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyerse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EpiCompare</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RColorBrewer</span>)</pre></body></html></div>
<p>you can look at the raw data using <code><a href="https://rdrr.io/r/utils/data.html">data(hagelloch_raw)</a></code> and see the details with <code><a href="../../reference/hagelloch_raw.html">?hagelloch_raw</a></code>.</p>
<p>A piece of the raw data is displayed in the following table</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span> <span class="fu">select</span>(<span class="no">PN</span>, <span class="no">NAME</span>, <span class="no">AGE</span>, <span class="no">SEX</span>, <span class="no">HN</span>, <span class="no">PRO</span>, <span class="no">ERU</span>, <span class="no">IFTO</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">10</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</pre></body></html></div>
<table class="table table table-striped table-hover">
<thead><tr>
<th style="text-align:right;">
PN
</th>
<th style="text-align:left;">
NAME
</th>
<th style="text-align:right;">
AGE
</th>
<th style="text-align:left;">
SEX
</th>
<th style="text-align:right;">
HN
</th>
<th style="text-align:left;">
PRO
</th>
<th style="text-align:left;">
ERU
</th>
<th style="text-align:right;">
IFTO
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mueller
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:left;">
1861-11-21
</td>
<td style="text-align:left;">
1861-11-25
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Mueller
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:left;">
1861-11-23
</td>
<td style="text-align:left;">
1861-11-27
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Mueller
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:left;">
1861-11-28
</td>
<td style="text-align:left;">
1861-12-02
</td>
<td style="text-align:right;">
172
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Seibold
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:left;">
1861-11-27
</td>
<td style="text-align:left;">
1861-11-28
</td>
<td style="text-align:right;">
180
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Motzer
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:left;">
1861-11-22
</td>
<td style="text-align:left;">
1861-11-27
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Motzer
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:left;">
1861-11-26
</td>
<td style="text-align:left;">
1861-11-29
</td>
<td style="text-align:right;">
180
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Schneck
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
1861-11-24
</td>
<td style="text-align:left;">
1861-11-28
</td>
<td style="text-align:right;">
42
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Schneck
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:left;">
1861-11-21
</td>
<td style="text-align:left;">
1861-11-26
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Schneck
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:left;">
1861-11-26
</td>
<td style="text-align:left;">
1861-11-30
</td>
<td style="text-align:right;">
182
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Schneck
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
1861-11-21
</td>
<td style="text-align:left;">
1861-11-25
</td>
<td style="text-align:right;">
45
</td>
</tr>
</tbody>
</table>
<p>where <code>PRO</code> is the date where prodromes (i.e. initial symptoms) began and <code>ERU</code> is the date of the measles rash. This data also includes the variable <code>IFTO</code> which is the (suspected) infector ID, which makes this data both highly informative and unusual! Only 2% of the infected children of the 188 total children do not have a reported infector ID.</p>
<p>The data also includes <span class="math inline">\(tI\)</span> and <span class="math inline">\(tR\)</span> which are estimated times of infection and recovery (see <span class="citation">Meyer, Held, and Höhle (2017)</span> for details). We plot the infection duration for each child, coloring the lines by household (with recycled colors) and arranging the children by household. From this we see that infection seems to be transmitted through the household ina short period of time where there is almost always overlap among infectious children within the household. We also arrange and color the lines by school grade, which shows us that the first class seems to all have been infected at approximately the same time.</p>
</div>
<div id="infection-duration-plots" class="section level2 tabset">
<h2 class="hasAnchor">
<a href="#infection-duration-plots" class="anchor"></a>Infection duration plots</h2>
<div id="by-household-id" class="section level3">
<h3 class="hasAnchor">
<a href="#by-household-id" class="anchor"></a>By Household ID</h3>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="no">HN</span>, <span class="no">NAME</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">new_id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">HN</span>, <span class="no">NAME</span>, <span class="no">PN</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"-"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">HN</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">new_id</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span>(<span class="no">new_id</span>, -<span class="no">tI</span>)) <span class="kw">%&gt;%</span>
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu">aes</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">new_id</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">HN</span>))) +
  <span class="fu">scale_colour_manual</span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">5</span>,<span class="st">"Set1"</span>),
                                <span class="kw">times</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">HN</span>)) / <span class="fl">5</span>)),
                      <span class="kw">guide</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="kw">xmax</span> <span class="kw">=</span> <span class="no">tR</span>, <span class="kw">xmin</span> <span class="kw">=</span> <span class="no">tI</span>), <span class="kw">size</span>  <span class="kw">=</span> <span class="fl">1</span>) + <span class="fu">theme_bw</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Date"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Child ID"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Infection time of children"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Colored by household ID (with recycled colors)"</span>) +
  <span class="fu">theme</span>(<span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>))</pre></body></html></div>
<p><img src="hagelloch-eda_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="by-school-grade" class="section level3">
<h3 class="hasAnchor">
<a href="#by-school-grade" class="anchor"></a>By School Grade</h3>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="no">CL</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">new_id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">CL</span>, <span class="no">PN</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"-"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">CL</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">new_id</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span>(<span class="no">new_id</span>, -<span class="no">tI</span>)) <span class="kw">%&gt;%</span>
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu">aes</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">new_id</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">CL</span>))+
  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="kw">xmax</span> <span class="kw">=</span> <span class="no">tR</span>, <span class="kw">xmin</span> <span class="kw">=</span> <span class="no">tI</span>), <span class="kw">size</span>  <span class="kw">=</span> <span class="fl">1</span>) + <span class="fu">theme_bw</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Date"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Child ID"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Infection time of children"</span>,
       <span class="kw">color</span> <span class="kw">=</span> <span class="st">"School Grade"</span>) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">theme</span>(<span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>))</pre></body></html></div>
<p><img src="hagelloch-eda_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div id="section" class="section level2 unnumbered">
<h2></h2>
</div>
<div id="infectors" class="section level2">
<h2 class="hasAnchor">
<a href="#infectors" class="anchor"></a>Infectors</h2>
<p>We can also count the infections produced. Here we see that one child is suspected of infecting 30 of others, most of which are his first school class peers.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">hagelloch_raw</span>$<span class="no">inf_trans</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">PN</span>, <span class="kw">function</span>(<span class="no">x</span>){
 <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">hagelloch_raw</span>$<span class="no">IFTO</span> <span class="kw">==</span> <span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)}
 )

<span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">inf_trans</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() + <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="no">PN</span>, <span class="no">inf_trans</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="no">inf_trans</span>,
                          <span class="kw">fill</span> <span class="kw">=</span> <span class="no">CL</span>)) +
  <span class="fu">coord_flip</span>() +
   <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"ID"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Number of (suspected) transmissions"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"(Suspected) Number of infections caused by child"</span>) +
  <span class="fu">theme_bw</span>()</pre></body></html></div>
<p><img src="hagelloch-eda_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="data-pre-processing-with-epicompare" class="section level2">
<h2 class="hasAnchor">
<a href="#data-pre-processing-with-epicompare" class="anchor"></a>Data pre-processing with <code>EpiCompare</code>
</h2>
<p>Viewing interesting information at the agent-level is interesting, but we would also like to visualize information at the aggreate level, i.e. the total number of children in a given infection state over time.</p>
<p>The funnction <code>EpiCompare::agent_to_aggregate()</code> converts the agent level data to an aggregate view. This is demonstrated below.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">aggregate_hag</span> <span class="kw">&lt;-</span> <span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../../reference/agents_to_aggregate.html">agents_to_aggregate</a></span>(<span class="kw">states</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">tI</span>, <span class="no">tR</span>)) <span class="kw">%&gt;%</span>
   <span class="fu">rename</span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">S</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">I</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">R</span> <span class="kw">=</span> <span class="no">X2</span>)

<span class="no">aggregate_hag</span> <span class="kw">%&gt;%</span> <span class="no">head</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</pre></body></html></div>
<table class="table table table-striped table-hover">
<thead><tr>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
S
</th>
<th style="text-align:right;">
I
</th>
<th style="text-align:right;">
R
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We can then plot, for instance, the number of infectious children over time.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">aggregate_hag</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>)) +
  <span class="fu">geom_line</span>(<span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>) +
  <span class="fu">geom_point</span>(<span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>) +
  <span class="fu">theme_bw</span>() +
  <span class="fu">labs</span>( <span class="kw">x</span><span class="kw">=</span> <span class="st">"Time after initial infection (days)"</span>,
        <span class="kw">y</span> <span class="kw">=</span> <span class="st">"# of infected children"</span>,
        <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Number of infectious children vs. time"</span>,
        <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Hagelloch, Germany 1861-1862"</span>)</pre></body></html></div>
<p><img src="hagelloch-eda_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p><code>EpiCompare::agent_to_aggregate()</code> also works on grouped data frames, meaning that we can aggregate the children by groups such as their class.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">aggregate_hag_class</span> <span class="kw">&lt;-</span> <span class="no">hagelloch_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">CL</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../../reference/agents_to_aggregate.html">agents_to_aggregate</a></span>(<span class="kw">states</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">tI</span>, <span class="no">tR</span>)) <span class="kw">%&gt;%</span>
   <span class="fu">rename</span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">S</span> <span class="kw">=</span> <span class="no">X0</span>, <span class="kw">I</span> <span class="kw">=</span> <span class="no">X1</span>, <span class="kw">R</span> <span class="kw">=</span> <span class="no">X2</span>)

<span class="no">aggregate_hag_class</span> <span class="kw">%&gt;%</span> <span class="no">head</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</pre></body></html></div>
<table class="table table table-striped table-hover">
<thead><tr>
<th style="text-align:left;">
CL
</th>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
S
</th>
<th style="text-align:right;">
I
</th>
<th style="text-align:right;">
R
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
1st class
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We can then plot, for instance, the number of infectious children over time.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">aggregate_hag_class</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">I</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">CL</span>,
             <span class="kw">col</span> <span class="kw">=</span> <span class="no">CL</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu">geom_point</span>() +
  <span class="fu">theme_bw</span>() +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">labs</span>( <span class="kw">x</span><span class="kw">=</span> <span class="st">"Time after initial infection (days)"</span>,
        <span class="kw">y</span> <span class="kw">=</span> <span class="st">"# of infected children"</span>,
        <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Number of infectious children vs. time"</span>,
        <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Hagelloch, Germany 1861-1862"</span>)</pre></body></html></div>
<p><img src="hagelloch-eda_files/figure-html/unnamed-chunk-10-1.png" width="700"> From this plot, it seems that the first class may have been infected before the other two, which is something we can incorporate into a model.</p>
</div>
<div id="in-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#in-summary" class="anchor"></a>In summary</h2>
<p>In this vignette, we introduced the Hagelloch measles data set. We showed some aspects of the data at the agent-level, and at the aggregate level. We used the <code>EpiCompare</code> function <code>agents_to_aggregate</code> to pre-process the data to convert it into a format to easily view aggregate level information that is compatible with <code>ggplot2</code> and other <code>tidyverse</code> style functions.</p>
<p>In the next vignette, we will…</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-anderson1992">
<p>Anderson, R, and R. May. 1992. <em>Infectious Diseases of Humans</em>. Oxford: Oxford University Press.</p>
</div>
<div id="ref-britton2011">
<p>Britton, Tom, Theodore Kypraios, and Philip D. O’Neill. 2011. “Inference for Epidemics with Three Levels of Mixing: Methodology and Application to a Measles Outbreak.” <em>Scandinavian Journal of Statistics</em> 38 (3): 578–99. <a href="https://doi.org/10.1111/j.1467-9469.2010.00726.x">https://doi.org/10.1111/j.1467-9469.2010.00726.x</a>.</p>
</div>
<div id="ref-cdc-measles2018">
<p>Centers for Disease Control and Prevention. 2018. “Measles History.” Available online at <a href="https://www.cdc.gov/measles/about">https://www.cdc.gov/measles/about</a>.</p>
</div>
<div id="ref-cori2013">
<p>Cori, Anne, Neil M. Ferguson, Christophe Fraser, and Simon Cauchemez. 2013. “A New Framework and Software to Estimate Time-Varying Reproduction Numbers During Epidemics.” <em>American Journal of Epidemiology</em> 178 (9): 1505–12. <a href="https://doi.org/10.1093/aje/kwt133">https://doi.org/10.1093/aje/kwt133</a>.</p>
</div>
<div id="ref-gallagher2019">
<p>Gallagher, Shannon K. 2019. “Catalyst: Agents of Change. Integration of Compartment and Agent-Based Models for Use in Infectious Disease Methodology.” PhD thesis, Carnegie Mellon University. <a href="https://skgallagher.github.io/papers/gallagher_dissertation.pdf">https://skgallagher.github.io/papers/gallagher_dissertation.pdf</a>.</p>
</div>
<div id="ref-getz2016">
<p>Getz, Wayne M, Colin Carlson, Eric Dougherty, Travis C Porco, and Richard Salter. 2016. “An Agent-Based Model of School Closing in Under-Vacccinated Communities During Measles Outbreaks.” In <em>Proceedings of the Agent-Directed Simulation Symposium</em>, 10. Society for Computer Simulation International.</p>
</div>
<div id="ref-groendyke2012">
<p>Groendyke, Chris, David Welch, and David R. Hunter. 2012. “A Network-Based Analysis of the 1861 Hagelloch Measles Data.” <em>Biometrics</em> 68 (3): 755–65. <a href="https://doi.org/10.1111/j.1541-0420.2012.01748.x">https://doi.org/10.1111/j.1541-0420.2012.01748.x</a>.</p>
</div>
<div id="ref-surveillance2017">
<p>Meyer, Sebastian, Leonhard Held, and Michael Höhle. 2017. “Spatio-Temporal Analysis of Epidemic Phenomena Using the R Package surveillance.” <em>Journal of Statistical Software</em> 77 (11): 1–55. <a href="https://doi.org/10.18637/jss.v077.i11">https://doi.org/10.18637/jss.v077.i11</a>.</p>
</div>
<div id="ref-roberts2004">
<p>Neal, Peter J., and Gareth O. Roberts. 2004. “Statistical inference and model selection for the 1861 Hagelloch measles epidemic.” <em>Biostatistics</em> 5 (2): 249–61. <a href="https://doi.org/10.1093/biostatistics/5.2.249">https://doi.org/10.1093/biostatistics/5.2.249</a>.</p>
</div>
<div id="ref-oesterle1992">
<p>Oesterle, H. 1992. “Statistische Reanalyse einer Masernepidemie 1861 in Hagelloch.” Eberhard-Karls-Universität Tübingen.</p>
</div>
<div id="ref-pfeilsticker1863">
<p>Pfeilsticker, A. 1863. “Beiträge zur Pathologie der Masern mit besonderer Berücksichtigung der statistischen Verhältnisse.” Eberhard-Karls-Universität Tübingen. <a href="http://www.archive.org/details/beitrgezurpatho00pfeigoog">http://www.archive.org/details/beitrgezurpatho00pfeigoog</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://skgallagher.github.io/">Shannon Gallagher</a>, <a href="https://benjaminleroy.github.io/">Benjamin LeRoy</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
